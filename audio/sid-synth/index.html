<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>SID Tracker</title>
<link href="style.css" rel="stylesheet" type="text/css">
</head>
<body>
<h1>SID Tracker</h1>
<div class="controls">
    <div class="control-section">
        <h3>Transport</h3>
        <button id="playButton">Play</button>
        <button id="stopButton">Stop</button>
        <button id="pauseButton">Pause</button>
    </div>
    
    <div class="control-section">
        <h3>Record</h3>
        <button id="recordButton">Record</button>
        <select id="recordVoiceSelect">
            <option value="0">Voice 1</option>
            <option value="1">Voice 2</option>
            <option value="2">Voice 3</option>
        </select>
        <select id="recordInstrumentSelect">
            <option value="0">Lead (Tri)</option>
        </select>
        <label><input type="checkbox" id="autoAdvanceCheck" checked> Auto-advance</label>
        <span id="recordStatus" style="display: none;">REC: Voice 1, Step 1</span>
    </div>
    
    <div class="control-section">
        <h3>Pattern</h3>
        <select id="patternSelect">
            <option value="0">A</option>
        </select>
        <button id="clearButton">Clear</button>
        <button id="copyPatternButton">Copy</button>
        <button id="pastePatternButton">Paste</button>
        <span id="patternLength">Length: 16</span>
    </div>
    
    <div class="control-section">
        <h3>Song</h3>
        <button id="songModeButton">Pattern Mode</button>
        <span id="songPosition">Pos: 1/1</span>
        <button id="songEditorButton">Song Editor</button>
    </div>
    
    <div class="control-section">
        <h3>Tempo</h3>
        <input type="range" id="bpmSlider" min="60" max="200" value="120">
        <span id="bpmDisplay">120 BPM</span>
        <button id="tapTempoButton">Tap</button>
    </div>
    
    <div class="control-section">
        <h3>Project</h3>
        <button id="saveButton">Save</button>
        <button id="loadButton">Load</button>
        <button id="exportButton">Export JSON</button>
        <button id="exportSIDButton">Export SID</button>
        <button id="testSIDButton">Test SID Player</button>
        <button id="importButton">Import</button>
        <input type="file" id="importFileInput" accept=".json,.sid" style="display: none;">
        <span id="testSIDStatus" style="display: none; font-size: 10px; color: #0A0;">Testing SID...</span>
    </div>
    
    <div class="control-section">
        <h3>Tools</h3>
        <button id="instrumentEditorButton">Instrument Editor</button>
        <button id="keyboardToggleButton">Enable Keyboard</button>
        <button id="helpButton">Help</button>
        <a href="about.html"><button>About</button></a>
        <label style="margin-left:8px; font-size: 12px; color:#ccc;">
          <input type="checkbox" id="lfoDebugToggle"> LFO Debug
        </label>
        <span id="lfoDebugLine" style="font-size: 11px; color:#9cf; margin-left:6px;"></span>
    </div>
</div>

<div id="tracker-container">
    <!-- Track 0 -->
    <div class="track" id="track-0">
        <h2>Voice 0</h2>
        <!-- Steps for Voice 0 -->
    </div>
    <!-- Track 1 -->
    <div class="track" id="track-1">
        <h2>Voice 1</h2>
        <!-- Steps for Voice 1 -->
    </div>
    <!-- Track 2 -->
    <div class="track" id="track-2">
        <h2>Voice 2</h2>
        <!-- Steps for Voice 2 -->
    </div>
</div>

<!-- Song Editor Modal -->
<div id="songEditorModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Song Editor</h2>
            <span class="close" id="closeSongEditor">&times;</span>
        </div>
        <div class="modal-body">
            <div class="song-info">
                <div class="param-row">
                    <label for="songTitle">Song Title:</label>
                    <input type="text" id="songTitle" value="Untitled Song">
                </div>
                <div class="param-row">
                    <label for="patternLengthSelect">Pattern Length:</label>
                    <select id="patternLengthSelect">
                        <option value="16">16 steps</option>
                        <option value="32">32 steps</option>
                        <option value="64">64 steps</option>
                    </select>
                </div>
            </div>
            
            <div class="song-sequence">
                <h3>Song Sequence</h3>
                <div id="sequenceList"></div>
                <div class="sequence-controls">
                    <select id="addPatternSelect">
                        <option value="0">Pattern A</option>
                    </select>
                    <button id="addToSequenceButton">Add</button>
                    <button id="removeFromSequenceButton">Remove</button>
                    <button id="clearSequenceButton">Clear All</button>
                </div>
            </div>
            
            <div class="pattern-list">
                <h3>Available Patterns</h3>
                <div id="patternGrid"></div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="saveSongButton">Save Changes</button>
            <button id="cancelSongButton">Cancel</button>
        </div>
    </div>
</div>

<!-- Instrument Editor Modal -->
<div id="instrumentEditorModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Instrument Editor</h2>
            <span class="close" id="closeInstrumentEditor">&times;</span>
        </div>
        <div class="modal-body">
            <div class="instrument-selector">
                <label for="editInstrumentSelect">Edit Instrument:</label>
                <select id="editInstrumentSelect"></select>
                <button id="newInstrumentButton">New Instrument</button>
                <button id="duplicateInstrumentButton">Duplicate</button>
                <button id="deleteInstrumentButton">Delete</button>
            </div>
            
            <div class="instrument-params">
                <div class="param-section">
                    <h3>Basic Parameters</h3>
                    <div class="param-row">
                        <label for="instrumentName">Name:</label>
                        <input type="text" id="instrumentName" maxlength="20">
                    </div>
                    <div class="param-row">
                        <label for="waveformSelect">Waveform:</label>
                        <select id="waveformSelect">
                            <option value="16">Triangle</option>
                            <option value="32">Sawtooth</option>
                            <option value="64">Pulse</option>
                            <option value="128">Noise</option>
                            <option value="48">Pulse + Sawtooth</option>
                            <option value="80">Pulse + Triangle</option>
                            <option value="144">Noise + Triangle</option>
                        </select>
                    </div>
                </div>

                <div class="param-section">
                    <h3>ADSR Envelope</h3>
                    <div class="param-row">
                        <label for="attackSlider">Attack: <span id="attackValue">0</span></label>
                        <input type="range" id="attackSlider" min="0" max="15" value="0">
                    </div>
                    <div class="param-row">
                        <label for="decaySlider">Decay: <span id="decayValue">0</span></label>
                        <input type="range" id="decaySlider" min="0" max="15" value="0">
                    </div>
                    <div class="param-row">
                        <label for="sustainSlider">Sustain: <span id="sustainValue">0</span></label>
                        <input type="range" id="sustainSlider" min="0" max="15" value="0">
                    </div>
                    <div class="param-row">
                        <label for="releaseSlider">Release: <span id="releaseValue">0</span></label>
                        <input type="range" id="releaseSlider" min="0" max="15" value="0">
                    </div>
                </div>

                <div class="param-section">
                    <h3>Pulse Width</h3>
                    <div class="param-row">
                        <label for="pulseWidthSlider">Width: <span id="pulseWidthValue">2048</span></label>
                        <input type="range" id="pulseWidthSlider" min="0" max="4095" value="2048">
                    </div>
                </div>

                <div class="param-section">
                    <h3>PWM LFO</h3>
                    <div class="param-row">
                        <label for="pwmLFOEnabled">
                            <input type="checkbox" id="pwmLFOEnabled"> Enable PWM LFO
                        </label>
                    </div>
                    <div class="param-row">
                        <label for="pwmLFOFreq">Frequency: <span id="pwmLFOFreqValue">0</span> Hz</label>
                        <input type="range" id="pwmLFOFreq" min="0.1" max="20" step="0.1" value="0">
                    </div>
                    <div class="param-row">
                        <label for="pwmLFODepth">Depth: <span id="pwmLFODepthValue">0</span>%</label>
                        <input type="range" id="pwmLFODepth" min="0" max="100" value="0">
                    </div>
                </div>

                <div class="param-section">
                    <h3>FM LFO</h3>
                    <div class="param-row">
                        <label for="fmLFOEnabled">
                            <input type="checkbox" id="fmLFOEnabled"> Enable FM LFO
                        </label>
                    </div>
                    <div class="param-row">
                        <label for="fmLFOFreq">Frequency: <span id="fmLFOFreqValue">0</span> Hz</label>
                        <input type="range" id="fmLFOFreq" min="0.1" max="20" step="0.1" value="0">
                    </div>
                    <div class="param-row">
                        <label for="fmLFODepth">Depth: <span id="fmLFODepthValue">0</span>%</label>
                        <input type="range" id="fmLFODepth" min="0" max="100" value="0">
                    </div>
                </div>

                <div class="param-section">
                    <h3>SID Features</h3>
                    <div class="param-row">
                        <label for="syncEnabled">
                            <input type="checkbox" id="syncEnabled"> Oscillator Sync
                        </label>
                    </div>
                    <div class="param-row">
                        <label for="ringModEnabled">
                            <input type="checkbox" id="ringModEnabled"> Ring Modulation
                        </label>
                    </div>
                </div>

                <div class="param-section">
                    <h3>Arpeggio</h3>
                    <div class="param-row">
                        <label for="arpeggioEnabled">
                            <input type="checkbox" id="arpeggioEnabled"> Enable Arpeggio
                        </label>
                    </div>
                    <div class="param-row">
                        <label for="arpeggioSpeed">Speed: <span id="arpeggioSpeedValue">4</span></label>
                        <input type="range" id="arpeggioSpeed" min="1" max="16" value="4">
                    </div>
                    <div class="param-row">
                        <label for="arpeggioPattern">Pattern:</label>
                        <select id="arpeggioPattern">
                            <option value="major">Major (0, 4, 7)</option>
                            <option value="minor">Minor (0, 3, 7)</option>
                            <option value="dim">Diminished (0, 3, 6)</option>
                            <option value="aug">Augmented (0, 4, 8)</option>
                            <option value="sus2">Sus2 (0, 2, 7)</option>
                            <option value="sus4">Sus4 (0, 5, 7)</option>
                            <option value="7th">7th (0, 4, 7, 10)</option>
                            <option value="maj7">Maj7 (0, 4, 7, 11)</option>
                            <option value="min7">Min7 (0, 3, 7, 10)</option>
                            <option value="octave">Octave (0, 12)</option>
                            <option value="fifth">Fifth (0, 7)</option>
                            <option value="fourth">Fourth (0, 5)</option>
                        </select>
                    </div>
                </div>
                <div class="param-section filter-section">
                    <h3>SID Filter</h3>
                    <div class="param-row">
                        <label for="filterEnabled">
                            <input type="checkbox" id="filterEnabled"> Enable Filter
                        </label>
                    </div>
                    <div class="param-row">
                        <label for="filterFrequency">Cutoff: <span id="filterFrequencyValue">1024</span></label>
                        <input type="range" id="filterFrequency" min="0" max="2047" value="1024">
                    </div>
                    <div class="param-row">
                        <label for="filterResonance">Resonance: <span id="filterResonanceValue">0</span></label>
                        <input type="range" id="filterResonance" min="0" max="240" step="16" value="0">
                    </div>
                    <div class="param-row">
                        <label for="filterType">Type:</label>
                        <select id="filterType">
                            <option value="16">Low-pass</option>
                            <option value="32">Band-pass</option>
                            <option value="64">High-pass</option>
                            <option value="48">Low-pass + Band-pass</option>
                            <option value="80">Low-pass + High-pass</option>
                            <option value="96">Band-pass + High-pass</option>
                            <option value="112">All-pass</option>
                        </select>
                    </div>
                </div>
                <div class="param-section filterlfo-section">
                    <h3>Filter LFO</h3>
                    <div class="param-row">
                        <label for="filterLFOEnabled">
                            <input type="checkbox" id="filterLFOEnabled"> Enable Filter LFO
                        </label>
                    </div>
                    <div class="param-row">
                        <label for="filterLFOFreq">Frequency: <span id="filterLFOFreqValue">0</span> Hz</label>
                        <input type="range" id="filterLFOFreq" min="0.1" max="10" step="0.1" value="0">
                    </div>
                    <div class="param-row">
                        <label for="filterLFODepth">Depth: <span id="filterLFODepthValue">0</span>%</label>
                        <input type="range" id="filterLFODepth" min="0" max="100" value="0">
                    </div>
                    <div class="param-row">
                        <label for="filterLFOContinuous">
                            <input type="checkbox" id="filterLFOContinuous"> Continuous (no reset)
                        </label>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button id="testInstrumentButton">Test Note</button>
                <button id="saveInstrumentButton">Save Changes</button>
                <button id="cancelInstrumentButton">Cancel</button>
            </div>
        </div>
    </div>
</div>

<!-- Help Modal -->
<div id="helpModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>SID Tracker Help</h2>
            <span class="close" id="closeHelp">&times;</span>
        </div>
        <div class="modal-body">
            <div class="help-section">
                <h3>üéµ Note Entry</h3>
                <p><strong>Note Formats:</strong></p>
                <ul>
                    <li><code>C-4, D#5, F-3</code> ‚Üí Play note (note + octave)</li>
                    <li><code>R</code> ‚Üí Rest (silence)</li>
                    <li><code>---</code> ‚Üí Sustain (continue previous note)</li>
                    <li><code>(empty)</code> ‚Üí Silence</li>
                </ul>
                <p><strong>Examples:</strong></p>
                <ul>
                    <li><code>C-4, ---, ---, E-4</code> ‚Üí C-4 plays for 3 steps, then E-4</li>
                    <li><code>C-3, R, D-3, ---</code> ‚Üí C-3, silence, D-3 for 2 steps</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>üéπ Keyboard Input</h3>
                <p><strong>Piano Layout:</strong></p>
                <div class="keyboard-layout">
                    <p><strong>Lower octave (C-3 to B-3):</strong><br>
                    <code>Z S X D C V G B H N J M</code><br>
                    <code>C C# D D# E F F# G G# A A# B</code></p>
                    
                    <p><strong>Higher octave (C-4 to B-4):</strong><br>
                    <code>Q 2 W 3 E R 5 T 6 Y 7 U</code><br>
                    <code>C C# D D# E F F# G G# A A# B</code></p>
                    
                    <p><strong>Even higher (C-5 to D#5):</strong><br>
                    <code>I 9 O 0 P</code><br>
                    <code>C C# D D# E</code></p>
                </div>
                <p><strong>üí° Tip:</strong> Click outside input fields to play, click in input fields to type</p>
            </div>

            <div class="help-section">
                <h3>üî¥ Recording Mode</h3>
                <p>Click "Record" to start recording notes from the keyboard:</p>
                <ul>
                    <li><code>Space</code> ‚Üí Record Rest</li>
                    <li><code>Enter</code> ‚Üí Record Sustain</li>
                    <li><code>‚Üê‚Üí</code> ‚Üí Switch voices</li>
                    <li><code>‚Üë‚Üì</code> ‚Üí Move between steps</li>
                    <li><code>Escape</code> ‚Üí Stop recording</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>üéõÔ∏è Transport Controls</h3>
                <ul>
                    <li><strong>Play:</strong> Start playback</li>
                    <li><strong>Stop:</strong> Stop playback</li>
                    <li><strong>Record:</strong> Enable recording mode</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>üéº Pattern Management</h3>
                <ul>
                    <li><strong>Pattern Select:</strong> Choose which pattern to edit (A, B, C, etc.)</li>
                    <li><strong>Copy/Paste:</strong> Copy pattern to clipboard and paste elsewhere</li>
                    <li><strong>Clear:</strong> Clear current pattern</li>
                    <li><strong>Song Editor:</strong> Arrange patterns into songs</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>üíæ Project Management</h3>
                <ul>
                    <li><strong>Save:</strong> Save to browser storage</li>
                    <li><strong>Load:</strong> Load from browser storage</li>
                    <li><strong>Export:</strong> Download as JSON file</li>
                    <li><strong>Import:</strong> Load JSON file</li>
                </ul>
            </div>
        </div>
        <div class="modal-footer">
            <button id="closeHelpButton">Close</button>
        </div>
    </div>
</div>

<!-- jsSID library (loaded as regular scripts to create global variables) -->
<script src="jsSID/js/stream.js"></script>
<script src="jsSID/js/jssid.core.js"></script>
<script src="jsSID/js/jssid.tinysid.js"></script>
<script src="jsSID/js/jssid.fastsid.js"></script>
<script src="jsSID/js/jssid.mos6510.js"></script>
<script src="jsSID/js/jssid.sidplayer.js"></script>
<script src="jsSID/js/pico.dev.js"></script>
<script type="module" src="jsSID/js/6502parser.js"></script>
<script type="module" src="jsSID/js/6502asm.js"></script>
<script type="module" src="synth.js"></script>
<script type="module" src="preload-audio.js"></script>
<script type="module" src="lfo-engine.js"></script>
<script type="module" src="arpeggio-engine.js"></script>
<script type="module" src="pattern-manager.js"></script>
<script type="module" src="tempo-control.js"></script>
<script type="module" src="keyboard-input.js"></script>
<script type="module" src="record-mode.js"></script>
<script type="module" src="sequencer.js"></script>
<script type="module" src="instrument-editor.js"></script>
<script type="module" src="song-editor.js"></script>
<script type="module" src="sid-exporter.js"></script>
<script type="module" src="sid-tester.js"></script>
<script type="module" src="main.js"></script>
</body>
</html>
